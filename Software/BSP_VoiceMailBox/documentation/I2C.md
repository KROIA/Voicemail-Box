# I2C
This class is a simplfied interface for the i2c peripheral.
All Basic functions used in the project are implemented here.
The implementaion is designed to be blocking.

## Content
- [Features](#features)
- [Setup](#setup)
- [Usage](#usage)
    - [Modify main.h and main.c](#modify-mainh-and-mainc)
    - [Inside the C++ Application](#inside-the-c-application)

---
## Features
- Writing one byte to a specific 8bit register on a I2C device.
- Reading one byte from a specifc 8bit register on a I2C device.

---
## Setup    
- Inside CubeMX, configure your i2c interface.
- Start the code generation and open the code editor.

---
## Usage
CubeMX generates a **I2C_HandleTypeDef** instance in the **main.c**
The **I2C** class needs access to that handle. Since the C++ code can't be used directly in the **main.c**, another way of getting to the handle is needed.
Make sure the C++ application is setup, you can find the instructions on how to do so [here](CppFromC.md).

#### Modify main.h and main.c
In the **main.h** create a get function that returns a pointer to the handle we want.
``` C
// main.h

// Function declaration
I2C_HandleTypeDef* getI2C_Handle();
```

``` C
// main.c

/* Private variables generated by CubeMX */
I2C_HandleTypeDef hi2c1;

/* USER CODE BEGIN PV */
// Function implementation
I2C_HandleTypeDef* getI2C_Handle()
{
    // Return the pointer to the handle
    return &hi2c1;
}
/* USER CODE END PV */
```

#### Inside the C++ Application
``` C++ 
// Application.cpp
#include "BSP_VoiceMailBox.hpp" // includes "peripherals/i2c.hpp"
#include "main.h" // Is needed to access the handle get function

// using a namespace globaly is not recommended for production
// but it simplyfies the example here
using namespace VoiceMailBox; 

// Create a I2C object and providing the handle from the main.c
I2C i2c(getI2C_Handle());

// Called periodically
void setup()
{
    VoiceMailBox::setup();
    uint8_t deviceAddress = 0x18;   // Use the address of the Codec
    uint8_t registerAddress = 0x00; // Use the "Page Select" register to write to the first page
    // inside the target.
    uint8_t dataToWrite = 0x01;

    // Writes the value 0x01 to the register 0x00 on the device 0x05.
    i2c.writeRegister(deviceAddress, registerAddress, dataToWrite);

    // Reads the register 0x00 from the device 0x18 and
    // stores the value in the <readData> variable
    uint8_t readData = 0;
    i2c.readRegister(deviceAddress, registerAddress, readData);
    println("Read data: 0x%02X", readData);
}
```