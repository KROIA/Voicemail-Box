# DigitalPin
This class can be used to write or read a digital pin state, depending on the configuration from within CubeMX.
You can find a ready to run project [here](../../Demos/F469/F469_MultiExample/README.md).

---
## Content
- [Features](#features)
- [Setup](#setup)
- [Usage](#usage)
    - [Simple](#simple)
    - [Use button callbacks](#use-button-callbacks)

---
## Features
For a pin, configured as input:
- Specify if the pin is inverted or not
- Read pin value
- Attach callbacks for events: **Falling**, **Rising** and **High**.

For a pin, configured as output:
- Specify if the pin is inverted or not
- Set pinstate to **LOW** or **HIGH**
- Toggle current pin state




---
## Setup
- Inside CubeMX, select a pin and configure it as **GPIO_Output** or **GPIO_Input**.
- Define a **User Label** for that pin in order to find it faster after code generation.
- Start the code generation and open the code editor.
- Make sure the C++ application is setup in order to use this class
You can find the instructions on how to do so [here](CppFromC.md).

---
## Usage
### Simple
The macros are generated by the CubeMX code generator
``` C++ 
// main.h
// ...

// Macro, created by the CubeMX code generator using the 
// UserLabel "LED1" (GPIO_Output)
#define LED1_Pin GPIO_PIN_11
#define LED1_GPIO_Port GPIOG

// UserLabel "BTN1" (GPIO_Input)
#define BTN1_Pin GPIO_PIN_12
#define BTN1_GPIO_Port GPIOG
```

To use the DigitalPin class, a c++ function is needed, therefore the following code is not inside the **main.c** but in a **Application.cpp**.
You can find instructions on how to setup a c++ function that can be called in the main.c [here](CppFromC.md).
``` C++ 
// Application.cpp
#include "BSP_VoiceMailBox.hpp" // includes "peripherals/digitalPin.hpp"

// using a namespace globaly is not recommended for production
// but it simplyfies the example here
using namespace VoiceMailBox; 

// Create a DigitalPin object
// Specify the port and pin, given by the macros
DigitalPin led1(LED0_GPIO_Port, LED0_Pin);
DigitalPin button1(BTN1_GPIO_Port, BTN1_Pin);

// Called periodically
void loop()
{
    // Set the pin to a high state
    led1.set(true);

    // Toggle the pin
    led1.toggle();

    // Reads the pin state
    bool buttonIsPressed = button1.get();
}
```
---
### Use button callbacks
When the DigitalPin is used as input, callback functions can be subscribed which get called when the pin state changes.
>:bulb: Pin change detection is not implemented using interrupts.

>:bulb: Only one callback for each of the 3 events are allowd.
Calling the **button1.setOnFallingEdgeCallback(...);** twice will overwrite the first callback function assigned to that specific pin event.

```C++
// Application.cpp
#include "BSP_VoiceMailBox.hpp" // includes "peripherals/digitalPin.hpp"
#include <stdio.h>

// using a namespace globaly is not recommended for production
// but it simplyfies the example here
using namespace VoiceMailBox; 

// Create a DigitalPin object
// Specify the port and pin, given by the macros
DigitalPin button1(BTN1_GPIO_Port, BTN1_Pin);

// Declare a callback function
void callbackWhenBtnDown(VoiceMailBox::DigitalPin& btn);

// Called once on startup after peripheral initialisation
void setup()
{
    // Setup the platform
    VoiceMailBox::setup();

    // Subscribing using a lambda function as callback
    button1.setOnFallingEdgeCallback([](DigitalPin&)    
        {
            // This code gets executed when the pin state gets 
            // from high to low.
            printf("Button pressed down");
        });
    
    button1.setOnRisingEdgeCallback([](DigitalPin&)    
        {
            // This code gets executed when the pin state gets 
            // from low to high.
            printf("Button released");
        });

    // Subscribing without a lamda function as callback
    button1.setOnDownCallback(callbackWhenBtnDown);
}

// Called periodically after setup
void loop()
{
    // Needs to be called periodically
    // This function checks the pin state change and triggers the callback functions
    button1.update();

    // The button1.update() already gets called from within this function:
    VoiceMailBox::update();
    // Therefore, if you put the VoiceMailBox::update(); in the loop, 
    // updating buttons must not be done manually.
}

// Gets called by the DigitalPin class automatically in its update function.
void callbackWhenBtnDown(VoiceMailBox::DigitalPin& btn)
{
    printf("Button is pressed");
}
```
